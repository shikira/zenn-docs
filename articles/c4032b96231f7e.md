---
title: "CDKã§ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ã‚’è©¦ã—ã¦ã¿ã‚‹"
emoji: "ğŸ“š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["aws", "cdk", "cognito"]
published: true
---

## ã¯ã˜ã‚ã«

å…ˆæœˆã€ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚
Hosted UIã‚ˆã‚Šã‚‚è¡¨ç¾åŠ›ãŒä¸ŠãŒã£ã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ã§ã€ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ã‚’æ¡ç”¨ã™ã‚‹æ©Ÿä¼šãŒå¢—ãˆãã†ã ã¨æ€ã£ã¦ã„ã¾ã™ã€‚

https://aws.amazon.com/jp/about-aws/whats-new/2024/11/amazon-cognito-managed-login/

re:Inventé–¢é€£ã§å¾Œå›ã—ã«ã—ã¦ã„ãŸã®ã§æ™‚é–“çµŒã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€è§¦ã£ã¦ã¿ã‚ˆã†ã‹ã¨æ€ã„ã¾ã™ã€‚

## ç’°å¢ƒæ§‹ç¯‰

ãƒãƒã‚³ãƒ³ã§ã‚µã‚¯ãƒƒã¨ä½œã‚Œã‚‹ã¨æ€ã†ã®ã§ã™ãŒã€CDKåŠ›å‘ä¸Šã¨å†ç¾æ€§ã‚’æ‹…ä¿ã—ãŸãã¦CDKã§å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸã€‚
ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ã®CDKå¯¾å¿œã¯ç¾çŠ¶L1ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ãƒˆã§æ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã§ã™ã€‚

https://github.com/shikira/aws-lab/tree/main/managed-login


https://github.com/shikira/aws-lab/blob/main/managed-login/lib/managed-login-stack.ts#L1-L71

ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ã«ã‚ˆã‚‹å®Ÿè£…ã¯ä¸»ã«ä»¥ä¸‹ã®ã‚ãŸã‚Šã§ã€`managedLoginVersion: 2`ãŒãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ã§1ãŒHosted UIã§ã™ã€‚
`useCognitoProvidedValues: true`ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ–ãƒ©ãƒ³ãƒ‰ã§ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚

https://github.com/shikira/aws-lab/blob/main/managed-login/lib/managed-login-stack.ts#L53-L64

ã¡ãªã¿ã«ã€aws-cdkã‚„aws-cdk-libãŒå¤ã„ã¨`CfnManagedLoginBranding`ã¨ã‹å­˜åœ¨ã—ãªã„ã®ã§ã”æ³¨æ„ã‚’ã€‚
https://github.com/shikira/aws-lab/blob/main/managed-login/package.json#L18-L23

## ç”»é¢ã‚’è§¦ã£ã¦è¦‹ã‚‹

ä½œæˆã—ãŸã‚¹ã‚¿ãƒƒã‚¯ -> `Outputs` -> `ManagedLoginUrl`ã‹ã‚‰ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚
ã¾ãšã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

![](/images/c4032b96231f7e/0001.png)

ãƒ¡ãƒ¼ãƒ«ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ã—ã¾ã™ã€‚

![](/images/c4032b96231f7e/0002.png)

ãƒ¡ãƒ¼ãƒ«ã«ã‚³ãƒ¼ãƒ‰ãŒå±Šã„ã¦ã„ã‚‹ã¨æ€ã†ã®ã§å…¥åŠ›ã—ã¦å®Œäº†ã§ã™ã€‚
![](/images/c4032b96231f7e/0003.png)

æˆåŠŸã™ã‚‹ã¨AWSã®ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«é£›ã¶ã‚ˆã†ã«ãªã£ã¦ã„ã¦ã€ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§codeã‚’æ¸¡ã—ã¦ã„ã‚Œã°æˆåŠŸã§ã™ã€‚

## CDKã§ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå®Ÿè£…ã«ã¤ã„ã¦

ç‹¬è‡ªã®ãƒ–ãƒ©ãƒ³ãƒ‰ã‚’ä½œã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ãŒã€ä¸€æ—¦ãƒãƒã‚³ãƒ³ã§ãƒ–ãƒ©ãƒ³ãƒ‰ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸå¾Œã€CLI/APIã§`DescribeManagedLoginBrandingByClient`ã‚’å®Ÿè¡Œã—ã¦è¨­å®šæƒ…å ±ã‚’å–å¾—ã—ã€CDKã«å¤‰æ›ã™ã‚‹ã“ã¨ãŒãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®ã‚ˆã†ã§ã™ã€‚

https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cognito-managedloginbranding.html#cfn-cognito-managedloginbranding-usecognitoprovidedvalues

> As a best practice, modify the output of DescribeManagedLoginBrandingByClient into the request parameters for this operation. To get all settings, set ReturnMergedResources to true. For more information, see API and SDK operations for managed login branding


ä»Šå›ã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ˜ãƒƒãƒ€ã«ãƒ­ã‚´ã‚’è¿½åŠ ã—ã¦ã€ãã®ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’jsonå‡ºåŠ›ã—ã¦ã¿ã¾ã™ã€‚

`Launch Branding designer`ã‚’èµ·å‹•

![](/images/c4032b96231f7e/0004.png)

Step 1-3ã¯ãã®ã¾ã¾

![](/images/c4032b96231f7e/0005.png)

Step4ã§ãƒ˜ãƒƒãƒ€ã‚’å¤‰ãˆã‚‰ã‚Œã‚‹ã®ã§ã€æ¡ä»¶ã«åˆã£ãŸç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€‚

![](/images/c4032b96231f7e/0006.png)

ä¿å­˜å¾Œã«ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ã„ãã¨ã¡ã‚ƒã‚“ã¨å¤‰æ›´ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹ã€‚

![](/images/c4032b96231f7e/0007.png)


ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ããŸã‚‰ã€`describe-managed-login-branding-by-client`ã‚³ãƒãƒ³ãƒ‰(é•·ã„w)ã§ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæƒ…å ±ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚

https://docs.aws.amazon.com/cli/latest/reference/cognito-idp/describe-managed-login-branding-by-client.html

```shell
aws cognito-idp describe-managed-login-branding-by-client --user-pool-id USER_POOL_ID --client-id CLIENT_ID > output.json
```

é€”ä¸­çœç•¥ã—ã¾ã™ãŒã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®šãŒ`Settings`ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸç”»åƒã¯`Assets`ã«å¤‰æ›ã•ã‚Œã¦ã„ã¾ã™ã€‚
```json
{
    "ManagedLoginBranding": {
        "ManagedLoginBrandingId": "a03211ea-5949-4b61-b3c3-2b361221f00b",
        "UserPoolId": "ap-northeast-1_jVoh2F4AF",
        "UseCognitoProvidedValues": false,
        "Settings": {
            "components": {
                ...
            }
        },
        "Assets": [
            {
                "Category": "PAGE_HEADER_LOGO",
                "ColorMode": "LIGHT",
                "Extension": "JPEG",
                "Bytes": "/9j/4AAQSkZJRgABAQAASAB..."
            }
        ],
        "CreationDate": "2024-12-21T17:55:28.413000+09:00",
        "LastModifiedDate": "2024-12-21T20:08:04.193000+09:00"
    }
}
```

ã“ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®šã‚’CDKåŒ–ã™ã‚‹ãªã‚‰`CfnManagedLoginBranding`ã§`useCognitoProvidedValues: false`ã¨æŒ‡å®šã—ã¦ã€`settings`ã¨`assets`ã«jsonã‹ã‚‰å–å¾—ã—ãŸå€¤ã‚’æŒ‡å®šã™ã‚‹ã€‚

https://github.com/shikira/aws-lab/blob/main/managed-login/lib/managed-login-stack.ts#L60-L64

```TypeScript
    new cdk.aws_cognito.CfnManagedLoginBranding(this, 'ManagedLoginBranding', {
      userPoolId: userPool.userPoolId,
      clientId: userPoolClient.userPoolClientId,
      useCognitoProvidedValues: false,
      settings: {...},
      assets: {...}
    })
```

## ãŠã‚ã‚Šã«

CDKã§ã‚‚L1ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ãƒˆãŒã‚ã‚‹ã®ã§ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ã‚’å®Ÿè£…ã§ãã¾ã—ãŸã€‚
ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã®CDKåŒ–ã¯ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«ãªã‚‰ã£ã¦ãƒãƒã‚³ãƒ³ã§ä¸€åº¦ä½œã£ã¦ã‹ã‚‰å‡ºåŠ›ã—ãŸæ–¹ãŒæ¥½ã ãªã¨æ„Ÿã˜ã¾ã—ãŸã€‚
ã‚ã¨ã¯ã€ã‚ã¾ã‚Šãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¯å¤‰æ›´ã—ãªã„ã®ã§ã€ã“ã®æ‰‹é †ã§ã‚‚ã€Œã¾ãã„ã„ã‹ãªãã€ã¨ã„ã†æ„Ÿæƒ³ã§ã™ãŒã€ç”»é¢ã§ã‚‚è¨­å®šå‡ºåŠ›ã‚ã‚‹ã¨å¬‰ã—ã„ãªã¨æ„Ÿã˜ã¾ã—ãŸã€‚
